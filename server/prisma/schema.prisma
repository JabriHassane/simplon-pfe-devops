// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  super_admin
  admin
  agent
}

enum OrderStatus {
  pending
  partially_paid
  paid
  cancelled
}

enum PaymentMethod {
  cash
  check
  tpe
  bankTransfer
}

enum TransactionType {
  purchase
  order
  transfer
}

enum DiscountType {
  fixed
  percentage
}

model User {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  name     String  @unique
  password String?
  role     Role

  // Relations
  agentOrders       Order[]       @relation("OrderAgent")
  agentPurchases    Purchase[]    @relation("PurchaseAgent")
  agentTransactions Transaction[] @relation("TransactionAgent")

  createdOrders Order[] @relation("OrderCreatedBy")
  updatedOrders Order[] @relation("OrderUpdatedBy")
  deletedOrders Order[] @relation("OrderDeletedBy")

  createdPurchases Purchase[] @relation("PurchaseCreatedBy")
  updatedPurchases Purchase[] @relation("PurchaseUpdatedBy")
  deletedPurchases Purchase[] @relation("PurchaseDeletedBy")

  createdAccounts Account[] @relation("AccountCreatedBy")
  updatedAccounts Account[] @relation("AccountUpdatedBy")
  deletedAccounts Account[] @relation("AccountDeletedBy")

  createdTransactions Transaction[] @relation("TransactionCreatedBy")
  updatedTransactions Transaction[] @relation("TransactionUpdatedBy")
  deletedTransactions Transaction[] @relation("TransactionDeletedBy")

  createdClients Client[] @relation("ClientCreatedBy")
  updatedClients Client[] @relation("ClientUpdatedBy")
  deletedClients Client[] @relation("ClientDeletedBy")

  createdSuppliers Supplier[] @relation("SupplierCreatedBy")
  updatedSuppliers Supplier[] @relation("SupplierUpdatedBy")
  deletedSuppliers Supplier[] @relation("SupplierDeletedBy")

  createdProductCategories ProductCategory[] @relation("ProductCategoryCreatedBy")
  updatedProductCategories ProductCategory[] @relation("ProductCategoryUpdatedBy")
  deletedProductCategories ProductCategory[] @relation("ProductCategoryDeletedBy")

  createdProducts Product[] @relation("ProductCreatedBy")
  updatedProducts Product[] @relation("ProductUpdatedBy")
  deletedProducts Product[] @relation("ProductDeletedBy")

  createdOrderItems OrderItem[] @relation("OrderItemCreatedBy")
  updatedOrderItems OrderItem[] @relation("OrderItemUpdatedBy")
  deletedOrderItems OrderItem[] @relation("OrderItemDeletedBy")

  createdPurchaseItems PurchaseItem[] @relation("PurchaseItemCreatedBy")
  updatedPurchaseItems PurchaseItem[] @relation("PurchaseItemUpdatedBy")
  deletedPurchaseItems PurchaseItem[] @relation("PurchaseItemDeletedBy")

  createdUsers User[] @relation("UserCreatedBy")
  updatedUsers User[] @relation("UserUpdatedBy")
  deletedUsers User[] @relation("UserDeletedBy")

  createdById String?
  createdBy   User?   @relation("UserCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("UserUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("UserDeletedBy", fields: [deletedById], references: [id])

  @@map("users")
}

model Client {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  name    String
  phone   String
  address String? @default("")

  // Relations
  orders Order[]

  createdById String?
  createdBy   User?   @relation("ClientCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("ClientUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("ClientDeletedBy", fields: [deletedById], references: [id])

  @@map("clients")
}

model Supplier {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  name    String
  phone   String
  address String? @default("")

  // Relations
  purchases Purchase[]

  createdById String?
  createdBy   User?   @relation("SupplierCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("SupplierUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("SupplierDeletedBy", fields: [deletedById], references: [id])

  @@map("suppliers")
}

model ProductCategory {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  name String

  // Relations
  products Product[]

  createdById String?
  createdBy   User?   @relation("ProductCategoryCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("ProductCategoryUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("ProductCategoryDeletedBy", fields: [deletedById], references: [id])

  @@map("product_categories")
}

model Product {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  name      String
  image     String
  price     Float
  inventory Int

  // Relations
  categoryId    String
  category      ProductCategory @relation(fields: [categoryId], references: [id])
  orderItems    OrderItem[]
  purchaseItems PurchaseItem[]

  createdById String?
  createdBy   User?   @relation("ProductCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("ProductUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("ProductDeletedBy", fields: [deletedById], references: [id])

  @@map("products")
}

model Order {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  date DateTime

  receiptNumber String
  invoiceNumber String

  totalPrice Float
  totalPaid  Float
  totalDue   Float

  status OrderStatus
  note   String

  discountAmount Float        @default(0)
  discountType   DiscountType @default(fixed)

  // Relations
  agentId String
  agent   User   @relation("OrderAgent", fields: [agentId], references: [id])

  clientId String
  client   Client @relation(fields: [clientId], references: [id])

  items    OrderItem[]
  payments Transaction[]

  createdById String?
  createdBy   User?   @relation("OrderCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("OrderUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("OrderDeletedBy", fields: [deletedById], references: [id])

  @@map("orders")
}

model OrderItem {
  id        String    @id @default(cuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  price    Float
  quantity Int

  // Relations
  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  createdById String?
  createdBy   User?   @relation("OrderItemCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("OrderItemUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("OrderItemDeletedBy", fields: [deletedById], references: [id])

  @@map("order_items")
}

model Purchase {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  date DateTime

  receiptNumber String
  invoiceNumber String

  totalPrice Float
  totalPaid  Float
  totalDue   Float

  status OrderStatus
  note   String

  discountAmount Float        @default(0)
  discountType   DiscountType @default(fixed)

  // Relations
  agentId String
  agent   User   @relation("PurchaseAgent", fields: [agentId], references: [id])

  supplierId String
  supplier   Supplier @relation(fields: [supplierId], references: [id])

  items    PurchaseItem[]
  payments Transaction[]

  createdById String?
  createdBy   User?   @relation("PurchaseCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("PurchaseUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("PurchaseDeletedBy", fields: [deletedById], references: [id])

  @@map("purchases")
}

model PurchaseItem {
  id        String    @id @default(cuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  price    Float
  quantity Int

  // Relations
  purchaseId String
  purchase   Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  createdById String?
  createdBy   User?   @relation("PurchaseItemCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("PurchaseItemUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("PurchaseItemDeletedBy", fields: [deletedById], references: [id])

  @@map("purchase_items")
}

model Account {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  name    String
  balance Float

  // Relations
  transactionsFrom Transaction[] @relation("AccountFrom")
  transactionsTo   Transaction[] @relation("AccountTo")

  createdById String?
  createdBy   User?   @relation("AccountCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("AccountUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("AccountDeletedBy", fields: [deletedById], references: [id])

  @@map("accounts")
}

model Transaction {
  id        String    @id @default(cuid())
  ref       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  deletedAt DateTime?

  date          DateTime
  type          TransactionType
  paymentMethod PaymentMethod?
  amount        Float

  // Relations
  agentId String
  agent   User   @relation("TransactionAgent", fields: [agentId], references: [id])

  orderId String?
  order   Order?  @relation(fields: [orderId], references: [id])

  purchaseId String?
  purchase   Purchase? @relation(fields: [purchaseId], references: [id])

  fromId String?
  from   Account? @relation("AccountFrom", fields: [fromId], references: [id])

  toId String?
  to   Account? @relation("AccountTo", fields: [toId], references: [id])

  createdById String?
  createdBy   User?   @relation("TransactionCreatedBy", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?   @relation("TransactionUpdatedBy", fields: [updatedById], references: [id])
  deletedById String?
  deletedBy   User?   @relation("TransactionDeletedBy", fields: [deletedById], references: [id])

  @@map("transactions")
}
